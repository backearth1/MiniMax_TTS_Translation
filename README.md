# ğŸ¬ FastAPI å¤šäººé…éŸ³ç”Ÿæˆå™¨

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104.1-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

ä¸€ä¸ªåŸºäº FastAPI çš„æ™ºèƒ½å¤šäººé…éŸ³ç”Ÿæˆç³»ç»Ÿï¼Œæ”¯æŒå­—å¹•æ–‡ä»¶è§£æã€è§’è‰²è¯­éŸ³åˆ†é…ã€å®æ—¶TTSç”Ÿæˆå’ŒéŸ³é¢‘åˆæˆã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½å­—å¹•è§£æ**ï¼šæ”¯æŒ SRT æ ¼å¼å­—å¹•æ–‡ä»¶ï¼Œè‡ªåŠ¨è¯†åˆ«è¯´è¯äººå’Œæƒ…ç»ª
- **å¤šäººé…éŸ³**ï¼šä¸ºä¸åŒè§’è‰²åˆ†é…ä¸åŒçš„AIè¯­éŸ³
- **å®æ—¶TTSç”Ÿæˆ**ï¼šåŸºäºMiniMax APIçš„é«˜è´¨é‡è¯­éŸ³åˆæˆ
- **éŸ³é¢‘æ—¶é—´è½´åŒæ­¥**ï¼šç²¾ç¡®çš„æ—¶é—´æˆ³å¯¹é½å’ŒéŸ³é¢‘æ‹¼æ¥
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡ç¿»è¯‘å’ŒTTSç”Ÿæˆ
- **å®æ—¶æ—¥å¿—**ï¼šWebSocketå®æ—¶æ—¥å¿—æ˜¾ç¤ºï¼Œå…¨ç¨‹å¯ç›‘æ§

### ğŸŒ ç”¨æˆ·ä½“éªŒ
- **ç°ä»£åŒ–Webç•Œé¢**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- **å®æ—¶è¿›åº¦æ˜¾ç¤º**ï¼šå¤„ç†è¿›åº¦å®æ—¶æ›´æ–°
- **éŸ³é¢‘é¢„è§ˆæ’­æ”¾**ï¼šæ”¯æŒåœ¨çº¿æ’­æ”¾å’Œä¸‹è½½
- **å¤šè¯­è¨€æ”¯æŒ**ï¼š25ç§è¯­è¨€çš„TTSæ”¯æŒ
- **ç”¨æˆ·é™æµ**ï¼šæ™ºèƒ½ç”¨æˆ·æ•°é‡æ§åˆ¶

### ğŸ”§ ç®¡ç†åŠŸèƒ½
- **ç®¡ç†å‘˜é¢æ¿**ï¼šå®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€å’Œç”¨æˆ·æ´»åŠ¨
- **èµ„æºç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§
- **ç”¨æˆ·æ´»åŠ¨è¿½è¸ª**ï¼šAPIè°ƒç”¨ç»Ÿè®¡å’Œç”¨æˆ·è¡Œä¸ºåˆ†æ
- **è‡ªåŠ¨æ¸…ç†**ï¼šç”¨æˆ·æ–­å¼€è¿æ¥åè‡ªåŠ¨æ¸…ç†ç›¸å…³æ–‡ä»¶

## ğŸ–¼ï¸ ç•Œé¢é¢„è§ˆ

![ç½‘ç«™æˆªå›¾](./screenshots/screenshot.png)

*ç°ä»£åŒ–çš„Webç•Œé¢ï¼Œæ”¯æŒå­—å¹•ä¸Šä¼ ã€å®æ—¶é…éŸ³ç”Ÿæˆå’ŒéŸ³é¢‘é¢„è§ˆ*

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- FFmpegï¼ˆç”¨äºéŸ³é¢‘å¤„ç†ï¼‰
- MiniMax API Key

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/backearth1/MiniMax_TTS_Translation.git
cd MiniMax_TTS_Translation

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡ï¼ˆè‡ªåŠ¨åˆ›å»ºæ‰€éœ€ç›®å½•ï¼‰
python3 main.py
```

### è®¿é—®æœåŠ¡

å¯åŠ¨æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š
- **ä¸»ç•Œé¢**: http://localhost:5215
- **APIæ–‡æ¡£**: http://localhost:5215/docs  
- **ç®¡ç†é¢æ¿**: http://localhost:5215/admin/dashboard

### å®‰è£…FFmpegï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é«˜çº§éŸ³é¢‘å¤„ç†åŠŸèƒ½ï¼š

```bash
# Ubuntu/Debian
sudo apt update && sudo apt install ffmpeg

# macOS
brew install ffmpeg

# Windows
# è¯·ä» https://ffmpeg.org/download.html ä¸‹è½½å¹¶æ·»åŠ åˆ°PATH
```

### é…ç½®è®¾ç½®

1. **è·å–MiniMax API Key**
   - è®¿é—® [MiniMaxå¼€æ”¾å¹³å°](https://platform.minimaxi.com)
   - æ³¨å†Œè´¦å·å¹¶è·å–APIå¯†é’¥

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼ˆå¯é€‰ï¼‰
   ```python
   # config.py ä¸­çš„ä¸»è¦é…ç½®é¡¹
   HOST = "0.0.0.0"          # æœåŠ¡å™¨åœ°å€
   PORT = 5215               # æœåŠ¡å™¨ç«¯å£
   MAX_FILE_SIZE = 10485760  # æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆ10MBï¼‰
   ```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨æµç¨‹

1. **ä¸Šä¼ å­—å¹•æ–‡ä»¶**
   - æ”¯æŒ `.srt` æ ¼å¼çš„å­—å¹•æ–‡ä»¶
   - æ–‡ä»¶å¤§å°é™åˆ¶ï¼š10MB
   - è‡ªåŠ¨è¯†åˆ«å­—ç¬¦ç¼–ç ï¼ˆUTF-8/GBKï¼‰

2. **é…ç½®APIå‚æ•°**
   ```
   Group ID: ä½ çš„MiniMax Group ID
   API Key: ä½ çš„MiniMax APIå¯†é’¥
   æ¨¡å‹é€‰æ‹©: speech-01 æˆ– speech-02-hd
   è¯­è¨€è®¾ç½®: æ”¯æŒ25ç§è¯­è¨€
   ```

3. **è®¾ç½®è§’è‰²è¯­éŸ³**
   - ä¸ºä¸åŒè§’è‰²åˆ†é…ä¸åŒçš„AIè¯­éŸ³
   - æ”¯æŒå¤šç§è¯­éŸ³é£æ ¼å’ŒéŸ³è‰²

4. **ç”Ÿæˆé…éŸ³**
   - ç‚¹å‡»"å¼€å§‹ç”Ÿæˆé…éŸ³"
   - å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦å’Œæ—¥å¿—
   - å®Œæˆåå¯åœ¨çº¿æ’­æ”¾å’Œä¸‹è½½

### é«˜çº§åŠŸèƒ½

#### å­—å¹•ç¼–è¾‘åŠŸèƒ½
- ä¸»é¡µé¢æ”¯æŒå­—å¹•å†…å®¹ä¿®æ”¹å’Œæ—¶é—´è°ƒæ•´
- æ”¯æŒåœ¨æŒ‡å®šä½ç½®æ’å…¥æ–°æ®µè½
- å®æ—¶é¢„è§ˆå’Œæ‰¹é‡æ“ä½œ

#### APIæ¥å£ä½¿ç”¨
```python
import requests

# ä¸Šä¼ å­—å¹•æ–‡ä»¶å¹¶ç”Ÿæˆé…éŸ³
files = {'file': open('subtitle.srt', 'rb')}
data = {
    'groupId': 'your_group_id',
    'apiKey': 'your_api_key',
    'model': 'speech-02-hd',
    'language': 'Chinese',
    'voiceMapping': '{"è§’è‰²1": "voice_id_1", "è§’è‰²2": "voice_id_2"}',
    'clientId': 'your_client_id'
}

response = requests.post('http://localhost:5215/api/generate-audio', 
                        files=files, data=data)
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„
```
fastapi-voice-generator/
â”œâ”€â”€ main.py                 # FastAPIä¸»åº”ç”¨
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt       # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ audio_processor.py    # éŸ³é¢‘å¤„ç†æ ¸å¿ƒ
â”œâ”€â”€ subtitle_manager.py   # å­—å¹•ç®¡ç†æ¨¡å—
â”œâ”€â”€ admin.py              # ç®¡ç†å‘˜åŠŸèƒ½
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ logger.py         # WebSocketæ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ static/               # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html       # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css    # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js       # å‰ç«¯é€»è¾‘
â”œâ”€â”€ outputs/              # ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ audio_files/          # éŸ³é¢‘ç‰‡æ®µç¼“å­˜
â”œâ”€â”€ temp_audio/           # ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
â””â”€â”€ uploads/              # ä¸Šä¼ æ–‡ä»¶ç¼“å­˜
```

### æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šFastAPI, Python 3.8+, WebSocket
- **å‰ç«¯**ï¼šåŸç”Ÿ JavaScript, Bootstrap 5, WebSocket
- **éŸ³é¢‘å¤„ç†**ï¼špydub, FFmpeg
- **TTSæœåŠ¡**ï¼šMiniMax API
- **ç³»ç»Ÿç›‘æ§**ï¼špsutil

## ğŸ”§ APIæ–‡æ¡£

### ä¸»è¦æ¥å£

| æ¥å£ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/generate-audio` | POST | ç”Ÿæˆé…éŸ³éŸ³é¢‘ |
| `/api/parse-subtitle` | POST | è§£æå­—å¹•æ–‡ä»¶ |
| `/api/subtitle/{id}/batch-translate` | POST | æ‰¹é‡ç¿»è¯‘ |
| `/api/subtitle/{id}/batch-generate-tts` | POST | æ‰¹é‡TTSç”Ÿæˆ |
| `/api/subtitle/{id}/merge-audio` | POST | åˆå¹¶éŸ³é¢‘ |
| `/admin/dashboard` | GET | ç®¡ç†å‘˜é¢æ¿ |
| `/ws/{client_id}` | WebSocket | å®æ—¶æ—¥å¿—è¿æ¥ |

è¯¦ç»†APIæ–‡æ¡£è¯·è®¿é—®ï¼šhttp://localhost:5215/docs

## âš™ï¸ é…ç½®è¯´æ˜

### è¯­éŸ³æ¨¡å‹é…ç½®
```python
TTS_CONFIG = {
    "default_model": "speech-02-hd",
    "default_language": "Chinese",
    "supported_languages": [
        "Chinese", "English", "Japanese", "Korean", 
        "Arabic", "Spanish", "French", "Russian",
        # ... æ›´å¤šè¯­è¨€
    ]
}
```

### è¯­éŸ³è§’è‰²æ˜ å°„
```python
VOICE_MAPPING = {
    "æ—ç™½": "presenter_male",
    "ç”·ä¸»": "audiobook_male_1", 
    "å¥³ä¸»": "audiobook_female_2",
    # ... è‡ªå®šä¹‰è§’è‰²
}
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **ç”¨æˆ·éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·çš„æ•°æ®å®Œå…¨éš”ç¦»
- **è‡ªåŠ¨æ¸…ç†**ï¼šç”¨æˆ·æ–­å¼€è¿æ¥åè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **é™æµæ§åˆ¶**ï¼šæœ€å¤§åŒæ—¶åœ¨çº¿ç”¨æˆ·æ•°é™åˆ¶
- **æ–‡ä»¶éªŒè¯**ï¼šä¸Šä¼ æ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œå¤„ç†

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å¤„ç†**ï¼šåŸºäºasyncioçš„é«˜å¹¶å‘å¤„ç†
- **å†…å­˜ç®¡ç†**ï¼šæ™ºèƒ½çš„ä¸´æ—¶æ–‡ä»¶æ¸…ç†æœºåˆ¶
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡ç¿»è¯‘å’ŒTTSç”Ÿæˆ
- **ç¼“å­˜ç­–ç•¥**ï¼šéŸ³é¢‘ç‰‡æ®µç¼“å­˜å’Œå¤ç”¨
- **è¿›åº¦è¿½è¸ª**ï¼šå®æ—¶å¤„ç†è¿›åº¦æ˜¾ç¤º

## ğŸš€ éƒ¨ç½²å»ºè®®

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.9-slim

# å®‰è£…FFmpeg
RUN apt-get update && apt-get install -y ffmpeg

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . /app
WORKDIR /app

# å®‰è£…ä¾èµ–
RUN pip install -r requirements.txt

# æš´éœ²ç«¯å£
EXPOSE 5215

# å¯åŠ¨æœåŠ¡
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "5215"]
```

### Nginxé…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5215;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /ws/ {
        proxy_pass http://127.0.0.1:5215;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºfeatureåˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-07-29)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒSRTå­—å¹•è§£æå’Œå¤šäººé…éŸ³
- ğŸŒ ç°ä»£åŒ–Webç•Œé¢
- ğŸ“Š ç®¡ç†å‘˜é¢æ¿å’Œç›‘æ§åŠŸèƒ½
- ğŸ”§ è‡ªåŠ¨æ–‡ä»¶æ¸…ç†æœºåˆ¶

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](https://opensource.org/licenses/MIT) å¼€æºåè®®ã€‚

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Webæ¡†æ¶
- [MiniMax](https://platform.minimaxi.com/) - é«˜è´¨é‡TTSæœåŠ¡
- [pydub](https://github.com/jiaaro/pydub) - éŸ³é¢‘å¤„ç†åº“
- [Bootstrap](https://getbootstrap.com/) - å‰ç«¯UIæ¡†æ¶

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- GitHub Issues: [é¡¹ç›®Issuesé¡µé¢](https://github.com/your-username/fastapi-voice-generator/issues)
- é‚®ç®±: your-email@example.com

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼ 